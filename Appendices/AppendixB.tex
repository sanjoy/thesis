\chapter{Source Code Snippets}

\label{AppendixB}

This appendix contains source code snippets referred from within the
text of this thesis.  They may not make sense in isolation.

\lhead{Appendix B. \emph{Source Code Snippets}}

\section{Sorting Benchmark}
\label{code:sorting-benchmark}

Source code to the benchmark used to evaluate the power consumption of
various sorting algorithms.  The code was compiled as

\begin{minted}[frame=lines]{bash}
cc -Wall -Werror -std=c99 -O3 -DNDEBUG sorting-algorithms.c  \
... -o sorting-algorithms-optimized
\end{minted}

\texttt{numbers.inc} is a list of 1000 random integers generated by a
python script.

\inputminted[linenos, frame=lines, baselinestretch=1, lastline=104]{cpp}{source/sorting-algorithms.cpp}

\section{Memory Access Benchmark}

\subsection{With Direct Increments}
\label{code:direct-mem}

\begin{gascode}
access_memory:
  movq    (%rdi),   %rax
  addq    8(%rdi),  %rax
  addq    16(%rdi), %rax
  addq    24(%rdi), %rax

  addq    32(%rdi), %rax
  addq    40(%rdi), %rax
  addq    48(%rdi), %rax
  addq    56(%rdi), %rax

  ret

  .globl  main

main:
  pushq   %rbp
  pushq   %rbx
  movl    $1024,    %ebx
  subq    $1032,    %rsp
  leaq    63(%rsp), %rbp
  andq    $-64,     %rbp

loop:
  movq    %rbp,  %rdi
  call    access_memory
  subl    $1,    %ebx
  jne     loop
  addq    $1032, %rsp
  xorl    %eax,  %eax
  popq    %rbx
  popq    %rbp
  ret
\end{gascode}

\subsection{With Grey-Code Increments}
\label{code:grey-mem}

\begin{gascode}
access_memory:
  movq    (%rdi),   %rax
  addq    8(%rdi),  %rax
  addq    24(%rdi), %rax
  addq    16(%rdi), %rax

  addq    48(%rdi), %rax
  addq    56(%rdi), %rax
  addq    40(%rdi), %rax
  addq    32(%rdi), %rax

  ret

  .globl  main

main:
  pushq   %rbp
  pushq   %rbx
  movl    $1024,    %ebx
  subq    $1032,    %rsp
  leaq    63(%rsp), %rbp
  andq    $-64,     %rbp

loop:
  movq    %rbp,  %rdi
  call    access_memory
  subl    $1,    %ebx
  jne     loop
  addq    $1032, %rsp
  xorl    %eax,  %eax
  popq    %rbx
  popq    %rbp
  ret
\end{gascode}
